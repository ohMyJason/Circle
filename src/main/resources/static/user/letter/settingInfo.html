<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>个人信息</title>
    <link rel="stylesheet" href="../../node_modules/css/navbar.css">
    <link rel="stylesheet" href="../../node_modules/css/footer.css">
    <link rel="stylesheet" href="../../node_modules/css/settingInfo.css">
    <link rel="stylesheet" href="http://ico.z01.com/zico.min.css">
    <link rel="stylesheet" href="../../node_modules/at-ui-style/css/at.css">
    <link rel="stylesheet" href="../../node_modules/bootstrap/css/bootstrap.css">
    <link rel="shortcut icon" href="../../../favicon.ico" type="image/x-icon">

    <script src="../../node_modules/jQuery/jquery-3.4.1.min.js"></script>
    <script src="../../node_modules/vue/dist/vue.js"></script>
    <script src="../../node_modules/layui/layui.js"></script>
    <script src="../../node_modules/js/jquery-cookie.js"></script>
    <script src="../../node_modules/bootstrap/js/bootstrap.js"></script>
    <script src="../../node_modules/at-ui/dist/at.js"></script>
</head>
<body>
<!---------------导航条---------------->
<header id="circle_navbar">
    <div id="app">
        <nav class="navbar navbar-expand-lg navbar-light bg-white navbar_c fixed-top">
            <div class="container-fluid">
                <!------------Logo图标------->
                <a class="navbar-brand col-xs-3 col-md-2" href="index.html">
                    <img src="../../node_modules/images/logo.png" class="img-fluid">
                </a>
                <!------------搜索框----------->
                <form class="form-inline input-group input-group-xs col-xs-8 col-md-4">
                    <input class="form-control" type="search" v-model="inputValue" placeholder="大家正在搜" aria-label="Search">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-sm" @click="searchBlog"><i class="zi zi_search"></i></span>
                    </div>
                </form>

                <!------------汉堡按钮------------>
                <button class="navbar-toggler col-xs-2 col-md-1 ml-5" type="button" data-toggle="collapse"
                        data-target="#circle_nav" aria-controls="circle_nav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon" style="width: 25px;margin-left: 5px;margin-right: 5px"></span>
                </button>

                <!------------六个导航按钮--------->
                <div class="collapse navbar-collapse col-lg-6" id="circle_nav">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item active">
                            <a class="nav-link" href="userIndex.html"><i class="icon icon-home"></i>首页</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../circle/circleRank.html"><i class="icon icon-aperture"></i>圈子</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../letter/session.html"><i class="icon icon-mail"></i>私信</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../user-center/personal.html"><i class="icon icon-user"></i>用户</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="newRegister.html" target="_blank">注册</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="modal" data-target="#exampleModalT">登录</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- 导航条模态框 -->
        <div class="modal fade" id="exampleModalT" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">账号登录</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="mr-3 input-group d-flex align-items-center mb-2">
                            <i class="icon icon-user mr-3" style="font-size: 25px"></i>
                            <input class="form-control" type="text" placeholder="请输入账号" onclick="this.placeholder='' " v-model="loginName">
                        </div>
                        <div class="mr-3 input-group d-flex align-items-center mb-1">
                            <i class="icon icon-lock mr-3" style="font-size: 25px"></i>
                            <input class="form-control" type="password" placeholder="请输入密码" onclick="this.placeholder='' " v-model="password">
                        </div>
                        <a href="retrieve.html" target="_blank" class="d-flex flex-end">忘记密码？</a>
                        <button type="button" class="btn btn-block bg-info mt-2" @click="login">立即登录</button>

                        <div class="row ml-2">
                            <span style="font-size: 14px">还没有账号？<a href="newRegister.html" target="_blank" style="color: #c7254e">立刻注册</a></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--<div class="container-fluid">-->
    <!--<iframe id="headerFrame" name="headerFrame" width="100%" src="../../navbar.html" frameborder="0" scrolling="no"></iframe>-->
    <!--</div>-->
</header>

<div id="app1" class="container">

    <div class="create-margin">
        <div class="row circle_frame">
            <div class="col-md-3"></div>
            <div class="col-md-18 setting_info">
                <div class="text_481X1">账号设置</div>
                <div class="box_480X1"></div>  <!--水平分隔线-->
                <div class="account_event">
                    <div class="row first_item">
                        <div class="row avatar_box col-md-11">
                            <span class="text_486X1">用户头像</span>
                            <form id="f" class="row">
                                <input type="file" @change="getFile" id="file" style="display: none">
                                <label for="file"><img :src="src" class="avatarUrl"></label>
                                <span class="text_487X1 flex-center" @click="submitAvatar()">上传</span>
                            </form>
                        </div>
                        <div class="row account_box col-md-11">
                            <span class="text_486X1">账户状态</span>
                            <span class="account_status" v-text="userInfo.status"></span>
                        </div>
                    </div>

                    <div class="row info_item">
                        <span class="text_485X1 col-md-6">用户名</span>
                        <span id="showName" class="show_info col-md-15" v-text="userInfo.userName"></span>
                        <span class="text_487X1 col-md-2 flex-center" @click="showNameInput()">编辑</span>
                    </div>
                    <div id="changeName" class="row change_info_item" style="display: none">
                        <span class="text_485X1 col-md-6">修改昵称</span>
                        <input id="changeNameInput" type="text" v-model="forwardInput1">
                        <span class="text_487X1 col-md-2 flex-center" @click="submitName()">确定</span>
                        <span class="text_487X1 col-md-2 flex-center" @click="cancelName()">取消</span>
                    </div>

                    <div class="row info_item">
                        <span class="text_485X1 col-md-6">手机号</span>
                        <span class="show_info col-md-15" v-text="userInfo.phone"></span>
                    </div>

                    <div class="row info_item">
                        <span class="text_485X1 col-md-6">邮箱</span>
                        <span id="showEmail" class="show_info col-md-15" v-text="userInfo.email"></span>
                        <span class="text_487X1 col-md-2 flex-center" @click="showEmailInput()">编辑</span>
                    </div>
                    <div id="changeEmail" class="row change_info_item" style="display: none">
                        <span class="text_485X1 col-md-6">修改邮箱</span>
                        <input id="changeEmailInput" type="text" v-model="forwardInput2">
                        <span class="text_487X1 col-md-2 flex-center" @click="submitEmail()">确定</span>
                        <span class="text_487X1 col-md-2 flex-center" @click="cancelEmail()">取消</span>
                    </div>

                    <div class="row info_item">
                        <span class="text_485X1 col-md-6">性别</span>
                        <span class="show_info col-md-15" v-text="userInfo.sex" v-cloak>{{forwardInput3}}</span>
                        <span class="text_487X1 col-md-2 flex-center" @click="showSexInput()">编辑</span>
                    </div>
                    <div id="changeSex" class="row change_info_item" style="display: none">
                        <span class="text_485X1 col-md-6">设置性别</span>
                        <input type="radio" id="one" value="0" v-model="forwardInput3"><label for="one">保密</label>
                        <input type="radio" id="two" value="1" v-model="forwardInput3"><label for="two">男</label>
                        <input type="radio" id="three" value="2" v-model="forwardInput3"><label for="three">女</label>
                        <span class="text_487X1 col-md-2 flex-center" @click="submitSex()">确定</span>
                        <span class="text_487X1 col-md-2 flex-center" @click="cancelSex()">取消</span>
                    </div>

                    <div class="row info_item">
                        <span class="text_485X1 col-md-6">感情状况</span>
                        <span class="show_info col-md-15" v-text="userInfo.isSingle" v-cloak>{{forwardInput4}}</span>
                        <span class="text_487X1 col-md-2 flex-center" @click="showSingleInput()">编辑</span>
                    </div>
                    <div id="changeSingle" class="row change_info_item" style="display: none">
                        <span class="text_485X1 col-md-6">修改感情状况</span>
                        <input type="radio" id="oneS" value="0" v-model="forwardInput4"><label for="oneS">保密</label>
                        <input type="radio" id="twoS" value="1" v-model="forwardInput4"><label for="twoS">单身</label>
                        <input type="radio" id="threeS" value="2" v-model="forwardInput4"><label for="threeS">恋爱</label>
                        <span class="text_487X1 col-md-2 flex-center" @click="submitSingle()">确定</span>
                        <span class="text_487X1 col-md-2 flex-center" @click="cancelSingle()">取消</span>
                    </div>

                    <div class="row info_item">
                        <span class="text_485X1 col-md-6">生日</span>
                        <span class="show_info col-md-15" v-cloak>{{userInfo.birthday}}</span>
                        <span class="text_487X1 col-md-2 flex-center" @click="showBirthInput()">编辑</span>
                    </div>
                    <div id="changeBirth" class="row change_info_item" style="display: none">
                        <span class="text_485X1 col-md-6">设置生日</span>
                        <select class="year" name="year" v-model="birthYear">
                            <option value="请选择" selected>请选择</option>
                            <option v-for="n in 2019" :value="n" v-text="n" v-if="n > 1900"></option>
                        </select>年
                        <select class="month" name="month" v-model="birthMonth">
                            <option value="请选择" selected>请选择</option>
                            <option v-for="n in 12" :value="n" v-text="n"></option>
                        </select>月
                        <select class="day" v-model="birthDay">
                            <option value="请选择" selected >请选择</option>
                            <option v-for="n in 31" :value="n" v-text="n"></option>
                        </select>日

                        <span class="text_487X1 col-md-2 flex-center" @click="submitBirth()">确定</span>
                        <span class="text_487X1 col-md-2 flex-center" @click="cancelBirth()">取消</span>
                    </div>

                    <div class="row info_item">
                        <span class="text_485X1 col-md-6">注册时间</span>
                        <span class="show_info col-md-15" v-text="userInfo.createTime"></span>
                    </div>

                    <div class="row info_item">
                        <span class="text_485X1 col-md-6">所在地</span>
                        <span class="show_info col-md-15" v-text="userInfo.address"></span>
                        <span class="text_487X1 col-md-2 flex-center" @click="showAddressInput()">编辑</span>
                    </div>
                    <div id="changeAddress" class="row change_info_item" style="display: none">
                        <span class="text_485X1 col-md-6">修改所在地</span>
                        <input id="changeAddressInput" type="text" v-model="forwardInput5">
                        <span class="text_487X1 col-md-2 flex-center" @click="submitAddress()">确定</span>
                        <span class="text_487X1 col-md-2 flex-center" @click="cancelAddress()">取消</span>
                    </div>

                    <div class="row info_item">
                        <span class="text_485X1 col-md-6">是否注销</span>
                        <span class="show_info col-md-15" v-text="userInfo.isDelete"></span>
                    </div>
                </div>

            </div>
            <div class="col-md-3"></div>
        </div>
    </div>
</div>
</body>
<script>
    //导航条搜索登录功能
    let vm = new Vue({
        el: '#circle_navbar',
        data: {
            inputValue: '',
            loginName: '',
            password: ''
        },methods:{
            //搜索功能
            searchBlog(){
                if (this.inputValue==''){
                    layui.use('layer', function () {
                        var layer = layui.layer;
                        layer.msg("搜索不能为空");
                    })
                }else {
                    window.location.href = "/user/blog/blog.html?content=" + this.inputValue
                }
            },

            //登录
            login:function () {
                if (this.loginName==''){
                    layui.use('layer',function() {
                        var layer = layui.layer;
                        layer.msg("请输入手机/用户名/邮箱！");
                    })
                }else if (this.password==''){
                    layui.use('layer',function() {
                        var layer = layui.layer;
                        layer.msg("请输入密码！");
                    })
                }else{
                    $.ajax({
                        url: "/userLogin/login",
                        type: "post",
                        data: {
                            loginName: this.loginName,
                            password: this.password,
                        },
                        success: function (result) {
                            if (result.code == 0) {
                                layui.use('layer',function() {
                                    var layer = layui.layer;
                                    layer.msg("登陆成功！");
                                });
                                window.location.href = "/user/index/userIndex.html";
                                $.cookie("token", result.data.token, {path: "/"});
                            } else {
                                layui.use('layer',function() {
                                    var layer = layui.layer;
                                    layer.msg("登陆失败！");
                                })
                            }
                        }
                    })
                }
            }
        }

    });
</script>
<script>
    var vm = new Vue({
        el: '#app1',
        data:{
            src:'',
            file:'',
            inputValue4:'',
            userInfo:{},
            forwardInput1:'',
            forwardInput2:'',
            forwardInput3:'',
            forwardInput4:'',
            forwardInput5:'',
            birthYear:"请选择",
            birthMonth:"请选择",
            birthDay:"请选择",
        },
        methods:{
            searchBlog(){
                if (this.inputValue4==''){
                    layui.use('layer', function () {
                        var layer = layui.layer;
                        layer.msg("搜索不能为空");
                    })
                }else {
                    window.location.href = "/user/blog/blog.html?content=" + this.inputValue4
                }
            },
            getFile(e) {
                let _this = this
                this.file = e.target.files[0];
                var files = e.target.files[0];
                if (!e || !window.FileReader) return  // 看支持不支持FileReader
                let reader = new FileReader()
                reader.readAsDataURL(files) // 这里是最关键的一步，转换就在这里
                reader.onloadend = function () {
                    _this.src = this.result
                }
            },
            showNameInput(){
                $("#changeName").css("display","block");
            },
            showEmailInput(){
                $("#changeEmail").css("display","block");
            },
            showSexInput(){
                $("#changeSex").css("display","block");
            },
            showSingleInput(){
                $("#changeSingle").css("display","block");
            },
            showBirthInput(){
                $("#changeBirth").css("display","block");
            },
            showAddressInput(){
                $("#changeAddress").css("display","block");
            },
            cancelName(){
                $("#changeName").css("display","none");
            },
            cancelEmail(){
                $("#changeEmail").css("display","none");
            },
            cancelSex(){
                $("#changeSex").css("display","none");
            },
            cancelSingle(){
                $("#changeSingle").css("display","none");
            },
            cancelBirth(){
                $("#changeBirth").css("display","none");
            },
            cancelAddress(){
                $("#changeAddress").css("display","none");
            },
            submitAvatar() {
                var form = new FormData();
                form.append('file',this.file);
                $.ajax({
                    url:"/userInfo/changeAvatar",
                    type:"post",
                    headers:{'token':$.cookie("token")},
                    async: false,
                    contentType: false,
                    processData:false,
                    data: form,
                    success:function (result) {
                        if (result.code == 0) {
                            vm.file='';
                            window.location.reload();
                        }else{
                            alert(result.msg);
                        }
                    }
                })
            },
            submitName(userId) {
                if (this.forwardInput1 == "") {
                    layui.use('layer',function() {
                        var layer = layui.layer;
                        layer.msg("用户名不能为空！");
                    })
                }else {
                    $.ajax({
                        url:"/userInfo/updateUserInfo",
                        type:"post",
                        headers:{'token':$.cookie("token")},
                        data:{
                            userId: userId,
                            userName: this.forwardInput1,
                        },
                        success:function (result) {
                            if(result.code == 0){
                                $("#showName").html($("#changeNameInput").val());
                                $("#changeName").css("display","none");
                            }
                        }
                    })
                }
            },
            submitEmail(userId) {
                var reg = /^\w+@\w+.[A-Za-z]{2,3}(.[A-Za-z]{2,3})?$/;
                if (this.forwardInput2 == "") {
                    layui.use('layer',function() {
                        var layer = layui.layer;
                        layer.msg("邮箱不能为空！");
                    })
                }else if (!reg.test(this.forwardInput2)) {
                    layui.use('layer',function() {
                        var layer = layui.layer;
                        layer.msg("邮箱格式不正确！");
                    })
                }else {
                    $.ajax({
                        url:"/userInfo/updateUserInfo",
                        type:"post",
                        headers:{'token':$.cookie("token")},
                        data:{
                            userId:userId,
                            email: this.forwardInput2,
                        },
                        success:function (result) {
                            if(result.code == 0){
                                $("#showEmail").html($("#changeEmailInput").val());
                                $("#changeEmail").css("display","none");
                            }
                        }
                    })
                }
            },
            submitSex(userId) {
                if (this.forwardInput3 == "") {
                    layui.use('layer',function() {
                        var layer = layui.layer;
                        layer.msg("输入不能为空！");
                    })
                }else {
                    $.ajax({
                        url:"/userInfo/updateUserInfo",
                        type:"post",
                        headers:{'token':$.cookie("token")},
                        data:{
                            userId:userId,
                            sex: this.forwardInput3,
                        },
                        success:function (result) {
                            if(result.code == 0){
                                if(vm.forwardInput3 == 0){
                                    vm.userInfo.sex = "保密";
                                }else if (vm.forwardInput3==1) {
                                    vm.userInfo.sex = "男";
                                }else if (vm.forwardInput3==2) {
                                    vm.userInfo.sex = "女";
                                }
                                $("#changeSex").css("display","none");
                            }
                        }
                    })
                }
            },
            submitSingle(userId) {
                if (this.forwardInput4 == "") {
                    layui.use('layer',function() {
                        var layer = layui.layer;
                        layer.msg("输入不能为空！");
                    })
                }else {
                    $.ajax({
                        url:"/userInfo/updateUserInfo",
                        type:"post",
                        headers:{'token':$.cookie("token")},
                        data:{
                            userId:userId,
                            isSingle: this.forwardInput4,
                        },
                        success:function (result) {
                            if(result.code == 0){
                                if(vm.forwardInput4 == 0){
                                    vm.userInfo.isSingle = "保密";
                                }else if (vm.forwardInput4==1) {
                                    vm.userInfo.isSingle = "单身";
                                }else if (vm.forwardInput4==2) {
                                    vm.userInfo.isSingle = "恋爱";
                                }
                                $("#changeSingle").css("display","none");
                            }
                        }
                    })
                }
            },
            submitBirth(userId) {
                if (this.birthYear == '请选择' || this.birthDay == '请选择' || this.birthMonth == '请选择') {
                    layui.use('layer',function() {
                        var layer = layui.layer;
                        layer.msg("请选择出生年月！");
                    })
                }else {
                    var birthday = this.birthYear+'-'+this.birthMonth+'-'+this.birthDay
                    $.ajax({
                        url:"/userInfo/updateUserInfo",
                        type:"post",
                        headers:{'token':$.cookie("token")},
                        data:{
                            userId:userId,
                            birthday: birthday,
                        },
                        success:function (result) {
                            if(result.code == 0){
                                vm.userInfo.birthday = birthday;
                                $("#changeBirth").css("display","none");
                            }
                        }
                    })
                }
            },
            submitAddress(userId) {
                if (this.forwardInput5 == "") {
                    layui.use('layer',function() {
                        var layer = layui.layer;
                        layer.msg("输入不能为空！");
                    })
                }else {
                    $.ajax({
                        url:"/userInfo/updateUserInfo",
                        type:"post",
                        headers:{'token':$.cookie("token")},
                        data:{
                            userId:userId,
                            address: this.forwardInput5,
                        },
                        success:function (result) {
                            if(result.code == 0){
                                $("#showAddress").html($("#changeAddressInput").val());
                                $("#changeAddress").css("display","none");
                            }
                        }
                    })
                }
            },


        },
        created(){
            $.ajax({
                url:"/userInfo/getUserInfo",
                type:"post",
                dataType:"json",
                headers:{'token':$.cookie("token")},
                success:function (result) {
                    if(result.code == 0) {
                        vm.userInfo = result.data;
                        //判断性别
                        if(result.data.sex==0){
                            vm.userInfo.sex = "保密";
                        }else if(result.data.sex==1){
                            vm.userInfo.sex = "男";
                        }else if(result.data.sex==2){
                            vm.userInfo.sex = "女";
                        }
                        //判断感情状况
                        if(result.data.isSingle == 0){
                            vm.userInfo.isSingle = "保密";
                        }else if(result.data.isSingle == 1){
                            vm.userInfo.isSingle = "单身";
                        }else if(result.data.isSingle == 2){
                            vm.userInfo.isSingle = "恋爱";
                        }
                        //判断账号状态
                        if(result.data.status == 0){
                            vm.userInfo.status = "正常";
                        }else{
                            vm.userInfo.status = "封禁";
                        }
                        //判断是否注销
                        if(result.data.isDelete == 0){
                            vm.userInfo.isDelete = "正常";
                        }else{
                            vm.userInfo.isDelete = "注销";
                        }
                        vm.src = vm.userInfo.avatarUrl;
                    }
                }
            })
        }
    })
</script>
</html>