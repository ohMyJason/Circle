<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>创建圈子</title>
    <link rel="stylesheet" href="../../node_modules/css/navbar.css">
    <link rel="stylesheet" href="../../node_modules/css/footer.css">
    <link rel="stylesheet" href="../../node_modules/css/createCircle.css">
    <link rel="stylesheet" href="http://ico.z01.com/zico.min.css">
    <link rel="stylesheet" href="../../node_modules/at-ui-style/css/at.css">
    <link rel="stylesheet" href="../../node_modules/bootstrap/css/bootstrap.css">
    <link rel="shortcut icon" href="../../../favicon.ico" type="image/x-icon">

    <script src="../../node_modules/jQuery/jquery-3.4.1.min.js"></script>
    <script src="../../node_modules/vue/dist/vue.js"></script>
    <script src="../../node_modules/layui/layui.js"></script>
    <script src="../../node_modules/js/jquery-cookie.js"></script>
    <script src="../../node_modules/bootstrap/js/bootstrap.js"></script>
    <script src="../../node_modules/at-ui/dist/at.js"></script>
</head>
<body>
<!---------------导航条---------------->
<header id="circle_navbar">
    <div id="app">
        <nav class="navbar navbar-expand-lg navbar-light bg-white navbar_c fixed-top">
            <div class="container-fluid">
                <!------------Logo图标------->
                <a class="navbar-brand col-xs-3 col-md-2" href="index.html">
                    <img src="../../node_modules/images/logo.png" class="img-fluid">
                </a>
                <!------------搜索框----------->
                <form class="form-inline input-group input-group-xs col-xs-8 col-md-4">
                    <input class="form-control" type="search" v-model="inputValue" placeholder="大家正在搜" aria-label="Search">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-sm" @click="searchBlog"><i class="zi zi_search"></i></span>
                    </div>
                </form>

                <!------------汉堡按钮------------>
                <button class="navbar-toggler col-xs-2 col-md-1 ml-5" type="button" data-toggle="collapse"
                        data-target="#circle_nav" aria-controls="circle_nav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon" style="width: 25px;margin-left: 5px;margin-right: 5px"></span>
                </button>

                <!------------六个导航按钮--------->
                <div class="collapse navbar-collapse col-lg-6" id="circle_nav">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item active">
                            <a class="nav-link" href="userIndex.html"><i class="icon icon-home"></i>首页</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../circle/circleRank.html"><i class="icon icon-aperture"></i>圈子</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../letter/session.html"><i class="icon icon-mail"></i>私信</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../user-center/personal.html"><i class="icon icon-user"></i>用户</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="newRegister.html" target="_blank">注册</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="modal" data-target="#exampleModalT">登录</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- 导航条模态框 -->
        <div class="modal fade" id="exampleModalT" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">账号登录</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="mr-3 input-group d-flex align-items-center mb-2">
                            <i class="icon icon-user mr-3" style="font-size: 25px"></i>
                            <input class="form-control" type="text" placeholder="请输入账号" onclick="this.placeholder='' " v-model="loginName">
                        </div>
                        <div class="mr-3 input-group d-flex align-items-center mb-1">
                            <i class="icon icon-lock mr-3" style="font-size: 25px"></i>
                            <input class="form-control" type="password" placeholder="请输入密码" onclick="this.placeholder='' " v-model="password">
                        </div>
                        <a href="retrieve.html" target="_blank" class="d-flex flex-end">忘记密码？</a>
                        <button type="button" class="btn btn-block bg-info mt-2" @click="login">立即登录</button>

                        <div class="row ml-2">
                            <span style="font-size: 14px">还没有账号？<a href="newRegister.html" target="_blank" style="color: #c7254e">立刻注册</a></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--<div class="container-fluid">-->
    <!--<iframe id="headerFrame" name="headerFrame" width="100%" src="../../navbar.html" frameborder="0" scrolling="no"></iframe>-->
    <!--</div>-->
</header>

<div id="app1" class="container">

    <div class="row create-margin">
        <div class="col-md-6"></div>
        <div class="col-md-12">
            <div class="row"><h1 class="h1-circle">开始创建你的圈子！</h1></div>
            <div class="row">
                <form class="circle-form">
                    圈子名称:<at-input v-model="circleName" placeholder="请输入名称" size="large"></at-input>
                    圈子主题:<at-input v-model="circleTitle" placeholder="一句话描述你的圈子"></at-input>
                    圈子头像:<br>
                    <input type="file" @change="getFile" id="file" style="display: none">
                    <label for="file"><img :src="src" class="img-container"></label><br>
                    <input type="button" class="at-btn--primary at-btn--large" value="创建圈子" @click="createCircle">
                </form>
                <div class="rule">
                    <h3>创建须知:</h3>
                    <span>1.创建者账号需处于正常使用状态!</span><br>
                    <span>2.圈子创建成功后，创建者的名称将永远展示在圈子中！</span><br>
                    <span>3.圈子中不得以任何途径和方式传播违禁信息！!</span><br>
                    <h4>以下内容为违规信息</h4>
                    <span>1.不符合社会主义核心价值观</span><br>
                    <span>2.传播扩散虚假信息和不良信息</span><br>
                    <span>3.宣传反动言论、宣传鬼神之说</span><br>
                    <span>4.其他违规信息</span><br>
                </div>
            </div>
        </div>
        <div class="col-md-6"></div>
    </div>
</div>

<script>
    //导航条搜索登录功能
    let vm = new Vue({
        el: '#circle_navbar',
        data: {
            inputValue: '',
            loginName: '',
            password: ''
        },methods:{
            //搜索功能
            searchBlog(){
                if (this.inputValue==''){
                    layui.use('layer', function () {
                        var layer = layui.layer;
                        layer.msg("搜索不能为空");
                    })
                }else {
                    window.location.href = "/user/blog/blog.html?content=" + this.inputValue
                }
            },

            //登录
            login:function () {
                if (this.loginName==''){
                    layui.use('layer',function() {
                        var layer = layui.layer;
                        layer.msg("请输入手机/用户名/邮箱！");
                    })
                }else if (this.password==''){
                    layui.use('layer',function() {
                        var layer = layui.layer;
                        layer.msg("请输入密码！");
                    })
                }else{
                    $.ajax({
                        url: "/userLogin/login",
                        type: "post",
                        data: {
                            loginName: this.loginName,
                            password: this.password,
                        },
                        success: function (result) {
                            if (result.code == 0) {
                                layui.use('layer',function() {
                                    var layer = layui.layer;
                                    layer.msg("登陆成功！");
                                });
                                window.location.href = "/user/index/userIndex.html";
                                $.cookie("token", result.data.token, {path: "/"});
                            } else {
                                layui.use('layer',function() {
                                    var layer = layui.layer;
                                    layer.msg("登陆失败！");
                                })
                            }
                        }
                    })
                }
            }
        }

    });
</script>
<script>
    var vm = new Vue({
        el: '#app1',
        data:{
            inputValue4:'',
            src:'../../node_modules/images/upload.png',
            circleName:'',
            circleTitle:'',
            flag:'false',
            file:''
        },methods: {
            searchBlog(){
                if (this.inputValue4==''){
                    layui.use('layer', function () {
                        var layer = layui.layer;
                        layer.msg("搜索不能为空");
                    })
                }else {
                    window.location.href = "/user/blog/blog.html?content=" + this.inputValue4
                }
            },
            getFile(e) {
                let _this = this
                this.file = e.target.files[0];
                this.flag = 'true';
                // console.log(this.file);
                var files = e.target.files[0];
                if (!e || !window.FileReader) return  // 看支持不支持FileReader
                let reader = new FileReader()
                reader.readAsDataURL(files) // 这里是最关键的一步，转换就在这里
                reader.onloadend = function () {
                    _this.src = this.result
                }
            },createCircle(){
                if (this.circleName==''){
                    layui.use('layer', function () {
                        var layer = layui.layer;
                        layer.msg("请输入圈子名称");
                    })
                }else if(this.circleName.length > 10){
                    layer.msg("圈子名长度不得超过10")
                }else if(this.circleTitle==''){
                    layer.msg("请输入圈子主题");
                }else if(this.circleTitle.length > 20){
                    layer.msg("圈子描述长度不得超过20");
                }else if(this.flag=='false'){
                    layer.msg("请选择图片");
                }else{
                    var myform = new FormData();
                    myform.append('file',this.file);
                    myform.append('circleName',this.circleName);
                    myform.append('circleTitle',this.circleTitle);
                    $.ajax({
                        url:'/circle/createCircle',
                        type:'post',
                        headers:{'token':$.cookie("token")},
                        async: false,
                        contentType: false,
                        processData: false,
                        data: myform,
                        success:function (result) {
                            if (result.code==0){
                                layui.use('layer',function() {
                                    var layer = layui.layer;
                                    layer.msg("创建成功！");
                                    window.location.href="/user/circle/circleRank.html"
                                })
                                vm.circleName = '';
                                vm.circleTitle ='';
                                vm.file='';
                            }else {
                                alert(result.msg)
                            }
                        }
                    })
                }
            }
        }
    })
</script>
</body>
</html>

